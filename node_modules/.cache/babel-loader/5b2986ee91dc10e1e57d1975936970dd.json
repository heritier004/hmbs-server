{"ast":null,"code":"import _regeneratorRuntime from\"/Users/heritier/repos/github/hmbs-server/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/heritier/repos/github/hmbs-server/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";PDFDocument=require('pdfKit');var path=require(\"path\");PDFDocument=require('pdfKit');var userid=require(\"./reservationController\");var db=require(\"../database/db\");var _require=require('../routes/reservationRoute'),use=_require.use;var printPdf=function printPdf(req,res,next){userId=req.params.id;scheduleId=req.params.schedId;resrvId=req.params.resId;var stream=res.writeHead(200,{'Content-Type':'application/pdf','Content-Disposition':'attachment ;filename = invoice.pdf'});buildPdf(function(chunk){return stream.write(chunk);},function(){return stream.end();});};function dbQuery1(){return new Promise(function(resolve,reject){db.query(\"select * from user where id = \".concat(userId),function(err,result){if(err){reject(err);}else{resolve(result);}});});}function dbQuery2(){return new Promise(function(resolve,reject){db.query(\"select * from schedule where id = \".concat(scheduleId),function(err,result){if(err){reject(err);}else{resolve(result);}});});}function dbQuery3(){return new Promise(function(resolve,reject){db.query(\"select * from reservation where id = \".concat(resrvId),function(err,result){if(err){reject(err);}else{resolve(result);}});});}function buildPdf(_x,_x2){return _buildPdf.apply(this,arguments);}function _buildPdf(){_buildPdf=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(dataCallback,endCallback){var user,schedule,reservation,doc;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return dbQuery1();case 2:user=_context.sent;_context.next=5;return dbQuery2();case 5:schedule=_context.sent;_context.next=8;return dbQuery3();case 8:reservation=_context.sent;// console.log(\"myresult\",user[0].id)\ndoc=new PDFDocument();doc.on('data',dataCallback);doc.on('end',endCallback);doc.image(path.join(__dirname,\"../\",\"netflix.png\"),{fit:[150,200]});doc.font('Courier').fontSize(20).text('HMBS Reservation confirmation ticket',{align:'right',marginBottom:'3px'});doc.text(\"************************************************************\");doc.text(\"Full Name : \".concat(user[0].firstname,\" \").concat(user[0].lastname));doc.text(\"Reservation Id: \".concat(reservation[0].id));doc.text(\"Schedule Time: \".concat(new Date(schedule[0].startTime).toString().split(\"GMT\")[0]));doc.text(\"************************************************************\");doc.text(\"Thank You For Your Visit\",{align:'center'});doc.end();case 21:case\"end\":return _context.stop();}}},_callee);}));return _buildPdf.apply(this,arguments);}module.exports={buildPdf:buildPdf,printPdf:printPdf};","map":{"version":3,"names":["PDFDocument","require","path","userid","db","use","printPdf","req","res","next","userId","params","id","scheduleId","schedId","resrvId","resId","stream","writeHead","buildPdf","chunk","write","end","dbQuery1","Promise","resolve","reject","query","err","result","dbQuery2","dbQuery3","dataCallback","endCallback","user","schedule","reservation","doc","on","image","join","__dirname","fit","font","fontSize","text","align","marginBottom","firstname","lastname","Date","startTime","toString","split","module","exports"],"sources":["/Users/heritier/repos/github/hmbs-server/src/controller/pdfService.js"],"sourcesContent":["PDFDocument = require('pdfKit');\nconst path = require(\"path\")\nPDFDocument = require('pdfKit');\nconst userid = require(\"./reservationController\");\nconst db = require(\"../database/db\");\nconst { use } = require('../routes/reservationRoute');\n\nconst printPdf = (req,res,next)=>{\n    userId = req.params.id\n    scheduleId = req.params.schedId;\n    resrvId = req.params.resId;\n    const stream = res.writeHead(200,{\n        'Content-Type':'application/pdf',\n        'Content-Disposition':'attachment ;filename = invoice.pdf'});\n\n\n    buildPdf(\n    (chunk)=>stream.write(chunk),\n    ()=> stream.end()\n);\n};\nfunction dbQuery1(){\n    return new Promise((resolve,reject)=>{\n        db.query(`select * from user where id = ${userId}`,(err,result)=>{\n            if(err){\n                reject(err)\n            }else{\n                resolve(result)\n            }\n        })\n    })\n}\nfunction dbQuery2(){\n    return new Promise((resolve,reject)=>{\n        db.query(`select * from schedule where id = ${scheduleId}`,(err,result)=>{\n            if(err){\n                reject(err)\n            }else{\n                resolve(result)\n            }\n        })\n    })\n}\nfunction dbQuery3(){\n    return new Promise((resolve,reject)=>{\n        db.query(`select * from reservation where id = ${resrvId}`,(err,result)=>{\n            if(err){\n                reject(err)\n            }else{\n                resolve(result)\n            }\n        })\n    })\n}\n\nasync function buildPdf(dataCallback,endCallback){\n    const user = await dbQuery1();\n    const schedule = await dbQuery2();\n    const reservation = await dbQuery3();\n    // console.log(\"myresult\",user[0].id)\n    const doc =  new PDFDocument();\n    doc.on('data',dataCallback);\n    doc.on('end',endCallback);\n    doc.image(path.join(__dirname,\"../\",\"netflix.png\"), {\n        fit: [150, 200]\n      });\n    doc.font('Courier').fontSize(20).text('HMBS Reservation confirmation ticket',{\n        align: 'right',\n        marginBottom : '3px'\n      });\n    doc.text(\"************************************************************\")\n    doc.text(`Full Name : ${user[0].firstname} ${user[0].lastname}`);\n    doc.text(`Reservation Id: ${reservation[0].id}`);\n    doc.text(`Schedule Time: ${new Date(schedule[0].startTime).toString().split(\"GMT\")[0]}`);\n    doc.text(\"************************************************************\")\n    doc.text(\"Thank You For Your Visit\",{\n        align: 'center'\n      }\n      );\n    doc.end(); \n}\n\nmodule.exports = {buildPdf:buildPdf , printPdf:printPdf};"],"mappings":"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"},"metadata":{},"sourceType":"module"}