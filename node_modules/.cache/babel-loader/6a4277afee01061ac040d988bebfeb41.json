{"ast":null,"code":"import _regeneratorRuntime from\"/Users/heritier/repos/github/hmbs-server/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/heritier/repos/github/hmbs-server/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";var db=require(\"../database/db\");var bcrypt=require(\"bcrypt\");var hashedDb;function verifyUser(_x,_x2,_x3){return _verifyUser.apply(this,arguments);}function _verifyUser(){_verifyUser=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(req,res,next){var pass,username,dbPass,decrypt2;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:pass=req.body.password;username=req.body.username;_context.next=4;return querySelect(username);case 4:dbPass=_context.sent;_context.next=7;return decrypt(pass,dbPass[0].password);case 7:decrypt2=_context.sent;res.send({bool:decrypt2,obj:dbPass});case 9:case\"end\":return _context.stop();}}},_callee);}));return _verifyUser.apply(this,arguments);}var querySelect=function querySelect(user){return new Promise(function(resolve,reject){db.query(\"select * from user where username = '\".concat(user,\"'\"),function(err,result){if(err)return reject(err);else{return resolve(result);};});});};function decrypt(pass,hashedDb){return new Promise(function(resolve,reject){resolve(bcrypt.compare(pass,hashedDb));});}function encryptPassword(_x4){return _encryptPassword.apply(this,arguments);}function _encryptPassword(){_encryptPassword=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(password){var saltRound,hashedPass;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return bcrypt.genSalt(10);case 2:saltRound=_context2.sent;_context2.next=5;return bcrypt.hash(password,saltRound);case 5:hashedPass=_context2.sent;return _context2.abrupt(\"return\",hashedPass);case 7:case\"end\":return _context2.stop();}}},_callee2);}));return _encryptPassword.apply(this,arguments);}function signupUser(_x5,_x6,_x7){return _signupUser.apply(this,arguments);}function _signupUser(){_signupUser=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(req,res,next){var hashedPass;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return encryptPassword(req.body.password);case 2:hashedPass=_context3.sent;db.query(\"INSERT INTO wapmovie.user (username, password, firstname, lastname) VALUES ('\".concat(req.body.username,\"', '\").concat(hashedPass,\"', '\").concat(req.body.name,\"', '\").concat(req.body.lastname,\"')\"),function(err,result){if(err){res.send({a:false});}else{res.send({a:true});};});case 4:case\"end\":return _context3.stop();}}},_callee3);}));return _signupUser.apply(this,arguments);}module.exports={verifyUser:verifyUser,signupUser:signupUser};module.exports={verifyUser:verifyUser,signupUser:signupUser};","map":{"version":3,"names":["db","require","bcrypt","hashedDb","verifyUser","req","res","next","pass","body","password","username","querySelect","dbPass","decrypt","decrypt2","send","bool","obj","user","Promise","resolve","reject","query","err","result","compare","encryptPassword","genSalt","saltRound","hash","hashedPass","signupUser","name","lastname","a","module","exports"],"sources":["/Users/heritier/repos/github/hmbs-server/src/controller/userContoller.js"],"sourcesContent":["const db = require(\"../database/db\");\nconst bcrypt = require(\"bcrypt\")\nlet hashedDb ;\n async function verifyUser(req,res,next){\n    const pass =  req.body.password;\n    const username= req.body.username;\n    const dbPass = await querySelect(username);\n    const decrypt2 = await decrypt(pass,dbPass[0].password);\n    res.send({bool:decrypt2, obj: dbPass});\n}\n\nconst querySelect = (user) =>{\n    return new Promise ((resolve, reject)=>{\ndb.query(`select * from user where username = '${user}'`,(err,result)=>{\n        if(err)\n               return reject(err);\n         else{\n                return resolve(result);\n            };  \n        }\n)\n    })};\n\nfunction decrypt(pass,hashedDb){\n        return new Promise((resolve,reject)=>{\n            resolve(bcrypt.compare(pass,hashedDb));\n        })\n    }\n\nasync function encryptPassword(password){\n            const saltRound =  await bcrypt.genSalt(10);\n            const hashedPass = await bcrypt.hash(password, saltRound)\n            return hashedPass;\n    }    \n    \nasync function signupUser(req, res, next){\n        let hashedPass = await encryptPassword(req.body.password);\n        db.query(\n            `INSERT INTO wapmovie.user (username, password, firstname, lastname) VALUES ('${req.body.username}', '${hashedPass}', '${req.body.name}', '${req.body.lastname}')`,\n            (err, result)=>{\n                if(err){\n                    res.send({a:false})\n                }else {\n                    res.send({a:true})\n                };\n                }\n        )\n\n     }\n    \nmodule.exports ={verifyUser :verifyUser, signupUser:signupUser}\nmodule.exports ={verifyUser :verifyUser, signupUser:signupUser}\n"],"mappings":"4QAAA,GAAMA,GAAE,CAAGC,OAAO,CAAC,gBAAD,CAAlB,CACA,GAAMC,OAAM,CAAGD,OAAO,CAAC,QAAD,CAAtB,CACA,GAAIE,SAAJ,C,QACgBC,W,oJAAf,iBAA0BC,GAA1B,CAA8BC,GAA9B,CAAkCC,IAAlC,sJACSC,IADT,CACiBH,GAAG,CAACI,IAAJ,CAASC,QAD1B,CAESC,QAFT,CAEmBN,GAAG,CAACI,IAAJ,CAASE,QAF5B,uBAGwBC,YAAW,CAACD,QAAD,CAHnC,QAGSE,MAHT,qCAI0BC,QAAO,CAACN,IAAD,CAAMK,MAAM,CAAC,CAAD,CAAN,CAAUH,QAAhB,CAJjC,QAISK,QAJT,eAKGT,GAAG,CAACU,IAAJ,CAAS,CAACC,IAAI,CAACF,QAAN,CAAgBG,GAAG,CAAEL,MAArB,CAAT,EALH,sD,6CAQD,GAAMD,YAAW,CAAG,QAAdA,YAAc,CAACO,IAAD,CAAS,CACzB,MAAO,IAAIC,QAAJ,CAAa,SAACC,OAAD,CAAUC,MAAV,CAAmB,CAC3CtB,EAAE,CAACuB,KAAH,gDAAiDJ,IAAjD,MAAyD,SAACK,GAAD,CAAKC,MAAL,CAAc,CAC/D,GAAGD,GAAH,CACO,MAAOF,OAAM,CAACE,GAAD,CAAb,CADP,IAEK,CACG,MAAOH,QAAO,CAACI,MAAD,CAAd,CACH,EACJ,CANT,EAQK,CATM,CAAP,CASG,CAVP,CAYA,QAASX,QAAT,CAAiBN,IAAjB,CAAsBL,QAAtB,CAA+B,CACvB,MAAO,IAAIiB,QAAJ,CAAY,SAACC,OAAD,CAASC,MAAT,CAAkB,CACjCD,OAAO,CAACnB,MAAM,CAACwB,OAAP,CAAelB,IAAf,CAAoBL,QAApB,CAAD,CAAP,CACH,CAFM,CAAP,CAGH,C,QAEUwB,gB,4JAAf,kBAA+BjB,QAA/B,wKACqCR,OAAM,CAAC0B,OAAP,CAAe,EAAf,CADrC,QACkBC,SADlB,uCAEqC3B,OAAM,CAAC4B,IAAP,CAAYpB,QAAZ,CAAsBmB,SAAtB,CAFrC,QAEkBE,UAFlB,iDAGmBA,UAHnB,0D,0DAMeC,W,qJAAf,kBAA0B3B,GAA1B,CAA+BC,GAA/B,CAAoCC,IAApC,8JAC+BoB,gBAAe,CAACtB,GAAG,CAACI,IAAJ,CAASC,QAAV,CAD9C,QACYqB,UADZ,gBAEQ/B,EAAE,CAACuB,KAAH,wFACoFlB,GAAG,CAACI,IAAJ,CAASE,QAD7F,gBAC4GoB,UAD5G,gBAC6H1B,GAAG,CAACI,IAAJ,CAASwB,IADtI,gBACiJ5B,GAAG,CAACI,IAAJ,CAASyB,QAD1J,OAEI,SAACV,GAAD,CAAMC,MAAN,CAAe,CACX,GAAGD,GAAH,CAAO,CACHlB,GAAG,CAACU,IAAJ,CAAS,CAACmB,CAAC,CAAC,KAAH,CAAT,EACH,CAFD,IAEM,CACF7B,GAAG,CAACU,IAAJ,CAAS,CAACmB,CAAC,CAAC,IAAH,CAAT,EACH,EACA,CART,EAFR,wD,6CAeAC,MAAM,CAACC,OAAP,CAAgB,CAACjC,UAAU,CAAEA,UAAb,CAAyB4B,UAAU,CAACA,UAApC,CAAhB,CACAI,MAAM,CAACC,OAAP,CAAgB,CAACjC,UAAU,CAAEA,UAAb,CAAyB4B,UAAU,CAACA,UAApC,CAAhB"},"metadata":{},"sourceType":"module"}