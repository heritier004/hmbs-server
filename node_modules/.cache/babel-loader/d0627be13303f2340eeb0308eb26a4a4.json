{"ast":null,"code":"import _regeneratorRuntime from\"/Users/heritier/repos/github/hmbs-server/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/heritier/repos/github/hmbs-server/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";var db=require(\"../database/db\");var nodemailer=require('nodemailer');var subjectLine=\"Confirmed: Your Sucssesfuly reserver movie\";var plainText=\" Dear ....\";var username,firstname,title,startTime,endTime,gener;var makeReservation=function makeReservation(req,res,next){db.query(\"Insert INTO reservation (scheduleid,userid) VALUES ('\".concat(req.body.selectedSched,\"','\").concat(req.body.userid,\"')\"),function(err,result){if(err){res.send(err);}else{res.send({code:result.insertId});}});db.query(\"select * from user where id = '\".concat(req.body.userid,\"'\"),function(err,result){if(err){console.log(err);}else{console.log(\"username: \",result[0].username);console.log(\"firstname: \",result[0].firstname);username=result[0].username;firstname=result[0].firstname;}});db.query(\"select * from schedule inner join movie on schedule.movieid = movie.id where schedule.id = \".concat(req.body.selectedSched),function(err,result){if(err){}else{console.log(\"title: \",result[0].title);console.log(\"startTime: \",result[0].startTime);console.log(\"endTime \",result[0].endTime);console.log(\"gener: \",result[0].gener);title=result[0].title;startTime=result[0].startTime;endTime=result[0].endTime;gener=result[0].gener;sendEmail();}});};var sendEmail=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var transporter,mailOptions;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:transporter=nodemailer.createTransport({service:\"hotmail\",auth:{user:'cinemahallmiu@outlook.com',pass:'Cinema@miu123'}});mailOptions={from:'cinemahallmiu@outlook.com',// sender address\nto:\"\".concat(username),// list of receivers\nsubject:\"\".concat(subjectLine),// Subject line\ntext:\"\".concat(plainText)// plain text body\n};transporter.sendMail(mailOptions,function(err,info){if(err)console.log(err);else console.log('Message Sent'+info.response);transporter.close();});case 3:case\"end\":return _context.stop();}}},_callee);}));return function sendEmail(){return _ref.apply(this,arguments);};}();var getUserReservations=function getUserReservations(req,res,next){//console.log(req.params.userID);\ndb.query(\"select schedule.starttime,movie.title,user.firstname,user.lastname from reservation join schedule on reservation.scheduleid = schedule.id join movie on schedule.movieid = movie.id join user on reservation.userid=user.id where reservation.userid=\".concat(req.params.userID),function(err,result){if(err){res.send(err);}else{res.send(result);}});};module.exports={makeReservation:makeReservation,getUserReservations:getUserReservations};","map":{"version":3,"names":["db","require","nodemailer","subjectLine","plainText","username","firstname","title","startTime","endTime","gener","makeReservation","req","res","next","query","body","selectedSched","userid","err","result","send","code","insertId","console","log","sendEmail","transporter","createTransport","service","auth","user","pass","mailOptions","from","to","subject","text","sendMail","info","response","close","getUserReservations","params","userID","module","exports"],"sources":["/Users/heritier/repos/github/hmbs-server/src/controller/reservationController.js"],"sourcesContent":["const db = require(\"../database/db\");\nconst nodemailer = require('nodemailer');\nvar subjectLine = \"Confirmed: Your Sucssesfuly reserver movie\";\nvar plainText = \" Dear ....\";\nvar username,firstname,title, startTime, endTime, gener;\n\n\nconst makeReservation = (req,res,next) =>{    \n    db.query(`Insert INTO reservation (scheduleid,userid) VALUES ('${req.body.selectedSched}','${req.body.userid}')`,(err,result)=>{\n        \n        if(err){\n            res.send(err);\n        }else{\n            res.send({code:result.insertId});\n        }\n    })\n\n    db.query(`select * from user where id = '${req.body.userid}'`,(err,result)=>{\n        if(err){\n            console.log(err)\n        }else{\n            console.log(\"username: \", result[0].username);\n            console.log(\"firstname: \", result[0].firstname);  \n            username = result[0].username;\n            firstname = result[0].firstname;\n        }\n    });\n\n    db.query(`select * from schedule inner join movie on schedule.movieid = movie.id where schedule.id = ${req.body.selectedSched}`,(err,result)=>{\n\n        if(err){\n\n        }else{\n            console.log(\"title: \", result[0].title);\n            console.log(\"startTime: \", result[0].startTime);\n            console.log(\"endTime \", result[0].endTime);\n            console.log(\"gener: \", result[0].gener);\n            title = result[0].title;\n            startTime = result[0].startTime;\n            endTime = result[0].endTime;\n            gener = result[0].gener;\n            sendEmail();\n          \n        }\n    });\n\n\n}\n    \n\nconst sendEmail= async function(){\n    const transporter = nodemailer.createTransport({\n        service: \"hotmail\",\n        auth: {\n            user: 'cinemahallmiu@outlook.com',\n            pass: 'Cinema@miu123'\n        }\n    });\n\n    const mailOptions = {\n        from: 'cinemahallmiu@outlook.com', // sender address\n        to: `${username}`, // list of receivers\n        subject: `${subjectLine}`, // Subject line\n        text: `${plainText}`, // plain text body\n    }\n    \n    transporter.sendMail(mailOptions, function (err, info) {\n        if(err)\n          console.log(err)\n        else\n        console.log('Message Sent' + info.response);\n        transporter.close();\n     });\n}\n\nconst getUserReservations = (req,res,next)=>{\n    //console.log(req.params.userID);\n   db.query(`select schedule.starttime,movie.title,user.firstname,user.lastname from reservation join schedule on reservation.scheduleid = schedule.id join movie on schedule.movieid = movie.id join user on reservation.userid=user.id where reservation.userid=${req.params.userID}`,(err,result)=>{\n    if(err){\n        res.send(err)\n    }else{\n        res.send(result);\n    }\n   });\n}\n\n\nmodule.exports= {makeReservation:makeReservation,getUserReservations:getUserReservations}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}